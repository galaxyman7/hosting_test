<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LAN P2P Chat + Hex Board</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 0; padding: 16px; }
  h1 { font-size: 1.3rem; margin-bottom: 8px; }
  h2 { font-size: 1.1rem; margin: 16px 0 8px; }
  button { padding: 6px 10px; margin: 4px; border-radius: 6px; cursor: pointer; }
  textarea { width: 100%; min-height: 70px; margin-top: 6px; }
  .panel { border: 1px solid #8884; border-radius: 8px; padding: 12px; margin-top: 12px; }
  .peer-card { border: 1px solid #8884; border-radius: 8px; padding: 10px; margin-top: 10px; }
  #chat { height: 180px; overflow: auto; border: 1px solid #8884; border-radius: 8px; padding: 8px; background: #f8f8f8; }
  .msg { margin: 4px 0; }
  .me { font-weight: bold; }

  /* Board styles */
  #boardPanel { display:none; }
  #boardContainer { overflow: auto; border: 1px solid #8884; border-radius: 8px; padding: 8px; background: #fafafa; }
  svg { max-width: 100%; height: auto; }
  .hex { fill: #eaeaea; stroke: #bbb; stroke-width: 1; }
  .edge { stroke: #666; stroke-width: 2; cursor: pointer; }
  .edge.bold { stroke: #000; stroke-width: 4; }
  .edge:hover { stroke: #333; }
</style>
</head>
<body>

<h1>LAN P2P Chat (Short Codes)</h1>
<div>
  <button id="hostBtn">Host</button>
  <button id="playerBtn">Player</button>
</div>

<div id="hostPanel" class="panel" style="display:none;">
  <h2>Host controls</h2>
  <button id="newOfferBtn">Create offer for new player</button>
  <div id="hostPeers"></div>
</div>

<div id="playerPanel" class="panel" style="display:none;">
  <h2>Player join</h2>
  <label>Paste host offer code:</label>
  <textarea id="offerInput"></textarea>
  <button id="createAnswerBtn">Create my answer</button>
  <label>Your answer code (copy this to host):</label>
  <textarea id="answerOutput" readonly></textarea>
  <button id="copyAnswerBtn">Copy Answer</button>
  <button id="finalizeBtn" disabled>Finalize connection</button>
  <div id="playerStatus">Not connected.</div>
</div>

<div id="chatPanel" class="panel" style="display:none;">
  <h2>Group chat</h2>
  <div id="chat"></div>
  <input id="chatInput" type="text" placeholder="Type a message..." />
  <button id="sendBtn" disabled>Send</button>
</div>

<div id="boardPanel" class="panel">
  <h2>Hex board (side length 6)</h2>
  <div id="boardContainer">
    <svg id="hexBoard" xmlns="http://www.w3.org/2000/svg"></svg>
  </div>
</div>

<!-- Compression library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

<script>
/* --- Chat + signaling code omitted for brevity (same as before) --- */
/* Keep your existing compressSDP, decompressSDP, waitForIceGathering, peers, chat functions, etc. */

/* ---------------------------
   Hex board rendering
---------------------------- */
const BOARD_SIDE = 6;
const RADIUS = BOARD_SIDE - 1; // 5
const HEX_SIZE = 24;
const BOARD_MARGIN = 20;
const hexBoard = document.getElementById('hexBoard');
const boldEdges = new Set();
const edgeEls = new Map();
let isHost = false;

function axialToPixel(q, r) {
  const x = HEX_SIZE * (Math.sqrt(3) * q + Math.sqrt(3)/2 * r);
  const y = HEX_SIZE * (3/2 * r);
  return { x, y };
}
function hexCorners(q, r) {
  const center = axialToPixel(q, r);
  const angles = [30, 90, 150, 210, 270, 330];
  return angles.map(a => {
    const rad = Math.PI * a / 180;
    return {
      x: center.x + HEX_SIZE * Math.cos(rad),
      y: center.y + HEX_SIZE * Math.sin(rad)
    };
  });
}
function eachHexCoord(fn) {
  for (let q = -RADIUS; q <= RADIUS; q++) {
    for (let r = -RADIUS; r <= RADIUS; r++) {
      const s = -q - r;
      if (Math.max(Math.abs(q), Math.abs(r), Math.abs(s)) <= RADIUS) {
        fn(q, r);
      }
    }
  }
}
function buildBoard() {
  let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
  eachHexCoord((q, r) => {
    const c = axialToPixel(q, r);
    minX = Math.min(minX, c.x - HEX_SIZE);
    maxX = Math.max(maxX, c.x + HEX_SIZE);
    minY = Math.min(minY, c.y - HEX_SIZE);
    maxY = Math.max(maxY, c.y + HEX_SIZE);
  });
  const width = (maxX - minX) + BOARD_MARGIN * 2;
  const height = (maxY - minY) + BOARD_MARGIN * 2;
  hexBoard.setAttribute('viewBox', `${minX - BOARD_MARGIN} ${minY - BOARD_MARGIN} ${width} ${height}`);

  const tileGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
  hexBoard.appendChild(tileGroup);
  const edgeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
  hexBoard.appendChild(edgeGroup);

  eachHexCoord((q, r) => {
    const corners = hexCorners(q, r);
    const poly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
    poly.setAttribute('class', 'hex');
    poly.setAttribute('points', corners.map(p => `${p.x},${p.y}`).join(' '));
    tileGroup.appendChild(poly);

    for (let e = 0; e < 6; e++) {
      const a = corners[e];
      const b = corners[(e + 1) % 6];
      const key = `${q},${r},${e}`;
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', a.x);
      line.setAttribute('y1', a.y);
      line.setAttribute('x2', b.x);
      line.setAttribute('y2', b.y);
      line.setAttribute('class', 'edge');
      line.dataset.key = key;
      line.addEventListener('click', () => {
        if (!isHost) return;
        toggleEdgeBold(key);
      });
      edgeGroup.appendChild(line);
      edgeEls.set(key, line);
    }
  });
}
function toggleEdgeBold(key) {
  if (boldEdges.has(key)) {
    boldEdges.delete(key);
  } else {
    boldEdges.add(key);
  }
  const el = edgeEls.get(key);
  if (el) {
    if (boldEdges.has(key)) el.classList.add('bold');
    else el.classList.remove('bold');
  }
}

/* Show board when Host or Player is clicked */
document.getElementById('hostBtn').onclick = () => {
  isHost = true;
  document.getElementById('hostPanel').style.display = '';
  document.getElementById('playerPanel').style.display = 'none';
  document.getElementById('chatPanel').style.display = '';
  document.getElementById('boardPanel').style.display = '';
};
document.getElementById('playerBtn').onclick = () => {
  isHost = false;
  document.getElementById('playerPanel').style.display = '';
  document.getElementById('hostPanel').style.display = 'none';
  document.getElementById('chatPanel').style.display = '';
  document.getElementById('boardPanel').style.display = '';
};

/* Build board on load */
buildBoard();
</